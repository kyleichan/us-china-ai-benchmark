<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Block Stacker</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            width:200px; height:300px;
            background:#8BC34A;
            overflow:hidden;
            position:relative;
            cursor:grab;
            user-select:none;
            touch-action:none;
        }
        body:active { cursor:grabbing; }
        
        .block {
            position:absolute;
            background:#795548;
            border:2px solid #5D4037;
            border-radius:3px;
            z-index:2;
            transition:all 0.1s linear;
        }
        
        .ground {
            position:absolute;
            bottom:0;
            width:100%;
            height:20px;
            background:#795548;
            border-top:4px solid #5D4037;
            z-index:1;
        }
        
        .tower-area {
            position:absolute;
            bottom:20px;
            left:90px;
            width:20px;
            height:250px;
            background:transparent;
            z-index:0;
        }
        
        .instructions {
            position:absolute;
            top:5px;
            left:5px;
            right:5px;
            text-align:center;
            font:10px Arial, sans-serif;
            color:#FFF;
            background:rgba(0,0,0,0.5);
            padding:5px;
            border-radius:3px;
            z-index:100;
        }
        
        .earthquake {
            animation:shake 0.5s infinite;
        }
        
        @keyframes shake {
            0%,100% { transform:translateX(0px); }
            25% { transform:translateX(1px); }
            50% { transform:translateX(-1px); }
            75% { transform:translateX(0.5px); }
        }
        
        .stability-warning {
            position:absolute;
            top:50px;
            width:100%;
            text-align:center;
            font:9px Arial, sans-serif;
            color:#FF5722;
            opacity:0;
            transition:opacity 0.3s;
            z-index:100;
        }
        
        .timer {
            position:absolute;
            top:25px;
            right:5px;
            font:9px Arial, sans-serif;
            color:#FFF;
            background:rgba(0,0,0,0.5);
            padding:2px 5px;
            border-radius:3px;
            z-index:100;
        }
    </style>
</head>
<body>
    <div class="instructions">Drag blocks to stack in tower area</div>
    <div class="stability-warning">Tower unstable!</div>
    <div class="timer">Quake: 5s</div>
    <div class="ground"></div>
    <div class="tower-area"></div>
    
    <script>
        (function() {
            const container = document.body;
            const blocks = [];
            let activeBlock = null;
            let offsetX = 0, offsetY = 0;
            let earthquakeActive = false;
            let quakeTimer = 5000;
            let stabilityWarning = document.querySelector('.stability-warning');
            let timerDisplay = document.querySelector('.timer');
            
            // Create 10 random blocks
            for(let i=0; i<10; i++) {
                const block = document.createElement('div');
                block.className = 'block';
                const width = 15 + Math.random()*25;
                const height = 10 + Math.random()*20;
                block.style.width = width + 'px';
                block.style.height = height + 'px';
                
                // Random starting positions on ground
                block.style.left = (Math.random()*160) + 'px';
                block.style.bottom = (20 + Math.random()*10) + 'px';
                
                block.dataset.originalBottom = block.style.bottom;
                block.dataset.originalLeft = block.style.left;
                block.dataset.placed = 'false';
                block.dataset.width = width;
                block.dataset.height = height;
                
                container.appendChild(block);
                blocks.push(block);
            }
            
            // Mouse/touch events
            container.addEventListener('mousedown', startDrag);
            container.addEventListener('touchstart', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag);
            document.addEventListener('mouseup', stopDrag);
            document.addEventListener('touchend', stopDrag);
            
            function startDrag(e) {
                e.preventDefault();
                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;
                
                const element = document.elementFromPoint(clientX, clientY);
                if(element && element.classList.contains('block')) {
                    activeBlock = element;
                    const rect = activeBlock.getBoundingClientRect();
                    offsetX = clientX - rect.left;
                    offsetY = clientY - rect.top;
                    activeBlock.style.zIndex = 100;
                }
            }
            
            function drag(e) {
                if(!activeBlock) return;
                e.preventDefault();
                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;
                
                const containerRect = container.getBoundingClientRect();
                let newX = clientX - containerRect.left - offsetX;
                let newY = containerRect.height - (clientY - containerRect.top - offsetY);
                
                // Boundary constraints
                newX = Math.max(0, Math.min(newX, 200 - activeBlock.offsetWidth));
                newY = Math.max(20, Math.min(newY, 300));
                
                activeBlock.style.left = newX + 'px';
                activeBlock.style.bottom = newY + 'px';
                
                // Check if block is in tower area (center)
                const towerCenter = 90;
                const blockCenter = newX + activeBlock.offsetWidth/2;
                if(Math.abs(blockCenter - towerCenter) < 15 && newY > 20) {
                    activeBlock.style.background = '#4CAF50';
                    checkStability();
                } else {
                    activeBlock.style.background = '#795548';
                }
            }
            
            function stopDrag() {
                if(!activeBlock) return;
                
                // Simulate gravity - block falls to ground or top of other blocks
                const blockRect = activeBlock.getBoundingClientRect();
                let lowestPoint = 20;
                
                blocks.forEach(b => {
                    if(b === activeBlock || b.dataset.placed === 'false') return;
                    const bRect = b.getBoundingClientRect();
                    
                    // Check if block is above another
                    if(blockRect.left < bRect.right && 
                       blockRect.right > bRect.left &&
                       blockRect.bottom <= bRect.top + 5) {
                        lowestPoint = Math.max(lowestPoint, parseFloat(b.style.bottom) + b.offsetHeight);
                    }
                });
                
                // Check if in tower area
                const towerCenter = 90;
                const blockCenter = parseFloat(activeBlock.style.left) + activeBlock.offsetWidth/2;
                
                if(Math.abs(blockCenter - towerCenter) < 15) {
                    activeBlock.style.bottom = lowestPoint + 'px';
                    activeBlock.dataset.placed = 'true';
                } else {
                    // Return to original position
                    activeBlock.style.bottom = activeBlock.dataset.originalBottom;
                    activeBlock.style.left = activeBlock.dataset.originalLeft;
                    activeBlock.dataset.placed = 'false';
                }
                
                activeBlock.style.zIndex = 2;
                activeBlock.style.background = activeBlock.dataset.placed === 'true' ? '#4CAF50' : '#795548';
                activeBlock = null;
                checkStability();
            }
            
            function checkStability() {
                let placedBlocks = blocks.filter(b => b.dataset.placed === 'true');
                if(placedBlocks.length < 2) {
                    stabilityWarning.style.opacity = 0;
                    return;
                }
                
                // Simple stability check - tower leans too much
                let totalOffset = 0;
                placedBlocks.forEach(b => {
                    const blockCenter = parseFloat(b.style.left) + b.offsetWidth/2;
                    totalOffset += Math.abs(blockCenter - 90);
                });
                
                const avgOffset = totalOffset / placedBlocks.length;
                if(avgOffset > 10 || earthquakeActive) {
                    stabilityWarning.style.opacity = 1;
                    
                    // If earthquake and unstable, blocks may fall
                    if(earthquakeActive && avgOffset > 15) {
                        simulateCollapse();
                    }
                } else {
                    stabilityWarning.style.opacity = 0;
                }
            }
            
            function simulateCollapse() {
                blocks.forEach(b => {
                    if(b.dataset.placed === 'true' && Math.random() > 0.5) {
                        b.dataset.placed = 'false';
                        b.style.bottom = b.dataset.originalBottom;
                        b.style.left = (parseFloat(b.dataset.originalLeft) + Math.random()*40 - 20) + 'px';
                        b.style.background = '#795548';
                    }
                });
            }
            
            // Earthquake simulation
            function startEarthquake() {
                earthquakeActive = true;
                container.classList.add('earthquake');
                stabilityWarning.style.opacity = 1;
                checkStability();
                
                setTimeout(() => {
                    earthquakeActive = false;
                    container.classList.remove('earthquake');
                    stabilityWarning.style.opacity = 0;
                }, 2000);
            }
            
            // Timer for earthquakes
            setInterval(() => {
                quakeTimer -= 1000;
                if(quakeTimer <= 0) {
                    startEarthquake();
                    quakeTimer = 5000 + Math.random()*5000;
                }
                timerDisplay.textContent = 'Quake: ' + (quakeTimer/1000) + 's';
            }, 1000);
        })();
    </script>
</body>
</html>